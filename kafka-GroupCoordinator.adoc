== [[GroupCoordinator]] GroupCoordinator

`GroupCoordinator` is...FIXME

`GroupCoordinator` is <<creating-instance, created>> when...FIXME

.GroupCoordinator's Startup
image::images/GroupCoordinator-startup.png[align="center"]

[[isActive]]
`GroupCoordinator` uses `isActive` flag to...FIXME

[[logIdent]]
`GroupCoordinator` uses *[GroupCoordinator [brokerId]]* as the logging prefix (aka `logIdent`).

=== [[apply]] Creating GroupCoordinator Instance -- `apply` Factory Method

[source, scala]
----
apply(
  config: KafkaConfig,
  zkClient: KafkaZkClient,
  replicaManager: ReplicaManager,
  time: Time): GroupCoordinator
apply(
  config: KafkaConfig,
  zkClient: KafkaZkClient,
  replicaManager: ReplicaManager,
  heartbeatPurgatory: DelayedOperationPurgatory[DelayedHeartbeat],
  joinPurgatory: DelayedOperationPurgatory[DelayedJoin],
  time: Time): GroupCoordinator
----

`apply`...FIXME

NOTE: `apply` is used exclusively when `KafkaServer` is requested to <<kafka-server-KafkaServer.adoc#startup, start up>>.

=== [[creating-instance]] Creating GroupCoordinator Instance

`GroupCoordinator` takes the following when created:

* [[brokerId]] Broker ID
* [[groupConfig]] `GroupConfig`
* [[offsetConfig]] link:kafka-OffsetConfig.adoc[OffsetConfig]
* [[groupManager]] <<kafka-GroupMetadataManager.adoc#, GroupMetadataManager>>
* [[heartbeatPurgatory]] `DelayedOperationPurgatory[DelayedHeartbeat]`
* [[joinPurgatory]] `DelayedOperationPurgatory[DelayedJoin]`
* [[time]] `Time`

`GroupCoordinator` initializes the <<internal-registries, internal registries and counters>>.

=== [[startup]] Starting Up (and GroupMetadataManager) -- `startup` Method

[source, scala]
----
startup(enableMetadataExpiration: Boolean = true): Unit
----

`startup` first prints out the following INFO message to the logs:

```
INFO [GroupCoordinator [brokerId]]: Starting up. (kafka.coordinator.group.GroupCoordinator)
```

With `enableMetadataExpiration` input flag enabled, `startup` requests <<groupManager, GroupMetadataManager>> to link:kafka-GroupMetadataManager.adoc#enableMetadataExpiration[enableMetadataExpiration].

`startup` turns <<isActive, isActive>> flag on.

In the end, `startup` prints out the following INFO message to the logs:

```
INFO [GroupCoordinator [brokerId]]: Startup complete. (kafka.coordinator.group.GroupCoordinator)
```

NOTE: `startup` is used exclusively when `KafkaServer` link:kafka-server-KafkaServer.adoc#startup[starts up].

=== [[partitionFor]] `partitionFor` Method

[source, scala]
----
partitionFor(group: String): Int
----

`partitionFor` simply requests the <<groupManager, GroupMetadataManager>> to <<kafka-GroupMetadataManager.adoc#partitionFor, partitionFor>> the input `group` ID.

NOTE: `partitionFor` is used when...FIXME

=== [[handleCommitOffsets]] `handleCommitOffsets` Method

[source, scala]
----
handleCommitOffsets(
  groupId: String,
  memberId: String,
  generationId: Int,
  offsetMetadata: immutable.Map[TopicPartition, OffsetAndMetadata],
  responseCallback: immutable.Map[TopicPartition, Errors] => Unit): Unit
----

`handleCommitOffsets`...FIXME

NOTE: `handleCommitOffsets` is used exclusively when `KafkaApis` is requested to <<kafka-server-KafkaApis.adoc#handleOffsetCommitRequest, handleOffsetCommitRequest>>.

=== [[doCommitOffsets]] `doCommitOffsets` Internal Method

[source, scala]
----
doCommitOffsets(
  group: GroupMetadata,
  memberId: String,
  generationId: Int,
  producerId: Long,
  producerEpoch: Short,
  offsetMetadata: immutable.Map[TopicPartition, OffsetAndMetadata],
  responseCallback: immutable.Map[TopicPartition, Errors] => Unit): Unit
----

`doCommitOffsets`...FIXME

NOTE: `doCommitOffsets` is used when `GroupCoordinator` is requested to <<handleTxnCommitOffsets, handleTxnCommitOffsets>> and <<handleCommitOffsets, handleCommitOffsets>>.

=== [[onCompleteJoin]] `onCompleteJoin` Method

[source, scala]
----
onCompleteJoin(group: GroupMetadata): Unit
----

`onCompleteJoin`...FIXME

NOTE: `onCompleteJoin` is used when...FIXME

=== [[doSyncGroup]] `doSyncGroup` Internal Method

[source, scala]
----
doSyncGroup(
  group: GroupMetadata,
  generationId: Int,
  memberId: String,
  groupAssignment: Map[String, Array[Byte]],
  responseCallback: SyncCallback): Unit
----

`doSyncGroup`...FIXME

NOTE: `doSyncGroup` is used when...FIXME

=== [[handleDescribeGroup]] `handleDescribeGroup` Method

[source, scala]
----
handleDescribeGroup(groupId: String): (Errors, GroupSummary)
----

`handleDescribeGroup`...FIXME

NOTE: `handleDescribeGroup` is used exclusively when `KafkaApis` is requested to <<kafka-server-KafkaApis.adoc#handleDescribeGroupRequest, handleDescribeGroupRequest>>.
